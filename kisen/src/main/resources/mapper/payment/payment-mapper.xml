<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="payment">

	<select id="selectAllList" resultMap="paymentResultMap">
		select
			pp.*,
			p.pd_name,
			ph.payment_no,
			ph.pay_content,
			ph.pay_type,
			ph.amount,
			ph.point,
			ph.waybill,
			pi.pd_category,
			pi.renamed_filename
		from
			payment_product pp
		left join
			pd_img pi
		on 
			pp.pd_no = pi.pd_no
		left join 
			payment_history ph
		on
			pp.payment_no = ph.payment_no
		left join
			product p
		on
			pp.pd_no = p.pd_no
		where
			pp.fan_no = #{fanNo}
			
	</select>
	<resultMap type="paymentProduct" id="paymentResultMap">
	 <id column ="payment_no" property="paymentNo"/>
	  <result column ="fan_no" property="fanNo"/>
      <result column="pay_type" property="payType"/>
      <result column="pay_content" property="payContent"/>
      <result column="pay_date" property="payDate"/>
      <result column="pd_no" property="pdNo"/>
      <result column="order_no" property="orderNo"/>
      
     <collection property="productImg" ofType="ProductImg">
          <id column="pd_no" property="pdNo"/>
          <result column="pd_img_no" property="pdImgNo"/>
          <result column="pd_category" property="pdCategory"/>
          <result column="original_filename" property="originalFilename"/>
          <result column="renamed_filename" property="renamedFilename"/>
          <result column="upload_date" property="uploadDate"/>
      </collection>
      
     <collection property="product" ofType="Product">
          <id column="pd_no" property="pdNo"/>
          <result column="idol_no" property="idolNo"/>
          <result column="pd_category" property="pdCategory"/>
          <result column="pd_name" property="pdName"/>
          <result column="pd_content" property="pdContent"/>  
          <result column="price" property="price"/>
          <result column="pd_stock" property="pdStock"/>
          <result column="pd_sales" property="pdSales"/>
          <result column="sales_date" property="salesDate"/>
      </collection>
	</resultMap>
	
	<select id="selectBasketList" resultMap="basketMap">
		 select
            b.*,
			p.pd_name,
			p.pd_content,
			p.price,
			pi.pd_category,
			pi.renamed_filename,
			po.option_name
		from
			basket b
		left join
			product p
		on
			b.product_no = p.pd_no
	left join 
			pd_img pi
		on
			b.product_no = pi.pd_no
   left join
			pd_option po
		on
			b.option_no = po.option_no
	<where> 
			b.fan_no = #{fanNo}
			
        and 
            pi.pd_category is null 
       or 
       	pi.pd_category= 'D'
	</where>	
	</select>
		<resultMap type="basket" id="basketMap">
	 <id column="product_no" property="pdNo"/>  
          <result column="idol_no" property="idolNo"/>
          <result column="pd_category" property="pdCategory"/>
          <result column="pd_name" property="pdName"/>
          <result column="pd_amount" property="pdAmount"/>
          <result column="pd_content" property="pdContent"/>
          <result column="price" property="price"/>
          <result column="pd_stock" property="pdStock"/>
          <result column="pd_sales" property="pdSales"/>
          <result column="sales_date" property="salesDate"/>
          <result column="option_no" property="opNo"/>
          <result column="fan_no" property="fanNo"/>
          
      
     <collection property="productImg" ofType="ProductImg">
          <id column="pd_no" property="pdNo"/>
          <result column="pd_img_no" property="pdImgNo"/>
          <result column="pd_category" property="pdCategory"/>
          <result column="original_filename" property="originalFilename"/>
          <result column="renamed_filename" property="renamedFilename"/>
          <result column="upload_date" property="uploadDate"/>
      </collection>
      
       <collection property="productOption" ofType="ProductOption">
          <id column="pd_no" property="pdNo"/>
          <result column="option_no" property="optionNo"/>
          <result column="option_name" property="optionName"/>
      </collection>
	</resultMap>
	
</mapper>